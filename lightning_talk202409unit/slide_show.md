---
marp: true
paginate: true
---

# Lightning Talk

CA Unit 2024-1HUnit会 9月

---

# 自己紹介

- 名前：平良一真
- 所属：ASD推進室
- 趣味：道の駅巡り

![bg right 80%](./IMG_1091.JPG)

---

# 今日のテーマは「非同期処理」

とはいえ、非同期を5分で語り尽くすのは到底無理なので・・・

---

# 5分で最低限の知識だけ詰め込むasync-await

↓こういうコードは見たことあるけど、いまいちよくわからんって人向け

```JavaScript
async function getHogeAsync(userId, password) {
  const token = await login(userId, password);
  return get(Path("hoge"), token);
}
```

<!--
5分でも内容もりもりなので急いで行きます。
予備校の授業みたいになりますがご容赦ください。
-->

---

# そもそも同期・非同期とは

## 同期処理

- コードを1行ずつ実行してそれが完了したら次の行に移るという順次実行の処理
- こちらが原則で、普通にコードを書くとこうなる

## 非同期処理

- 実行したコードの **完了を待たずに** 次の行に移るという処理
- こちらは例外で、非同期処理をするには専用の記法がある

<!--
その非同期処理にする専用の記法がこちらです。
-->

---

# <!--fit--> async

---

# async

関数を非同期にするキーワード

---

# 非同期の関数とは処理の完了を待たない関数

- httpリクエスト・ファイル読み書き・DBへのクエリ発行のような外部に依存する処理は結果が返るまで待ち時間が生じる
- 同期処理では実行した処理の完了を待つので待ち時間が無駄になってしまう
- 非同期処理では完了を待たないので待ち時間で別の処理できて効率的！

<!--
では、処理を完了していない状態で関数を抜けると返り値として何を返すのかというと・・・
-->

---

# <!--fit--> Promise

## <div style="text-align: right;">など</div>

---

# Promise（など）

非同期処理およびその結果を表すclass、およびその型のインスタンス

主に、非同期関数が返り値として返す

- （注）「 **（など）** 」とついているのは言語によって型名が異なるため

---

# Promise（など）は非同期処理の進捗と成否を持つ

- 大きく分けて「完了前」「成功」「失敗」の3つの状態を持つ
  - 「完了前」の場合は、処理が完了していないのでまだ結果は取れない
    - 結果が欲しければ待機しなくてはならない
  - 「成功」の場合は、既に処理が完了しているので結果が取れる
  - 「失敗」の場合は、結果として例外が投げられる

<!--
では、完了前のPromise（など）をどうやって待機するのかというと・・・
-->

---

# <!--fit--> await

---

# await

Promise（など）の完了を待機するキーワード

---

# awaitは非同期処理をいい感じに待機してくれる

- 同期処理も処理の完了を待機していた
- awaitも同じく処理の完了を待機する、その違いは・・・
1. どこにawaitを置くかでいつ待機するかを選択できる
    - どれを並行で処理するか、どこで待ち合わせるかは非同期処理の腕の見せ所
1. 他の処理を並行で受け付けられるような **いい感じの待ち方** をしてくれる
    - 並行で受け付けたい処理の例として、UIを持つアプリでの再描画や各種イベントなどが挙げられる
      - いい感じの待ち方でない同期処理では、これらイベントが並行処理できず待ち時間の間UIがフリーズしてしまう

<!--
いい感じとお茶を濁しているのは言語や実行環境によって変わるためです。
ただ、これは言語が実装してくれている部分なので意識しなくとも良いです。
-->

---

# 本日のまとめ

- 同期・非同期
  - 同期は処理の **完了を待って** 次の処理に進む
  - 非同期は処理の **完了を待たず** に次の処理に進む
- async
  - 関数を非同期にするキーワード
  - 処理結果そのものでなくPromise（など）を返す
- Promise（など）
  - 非同期処理およびその結果を表すclass
  - **完了前** ・ **成功** ・ **失敗** の状態を持つ
- await
  - Promise（など）の完了を待機するキーワード
  - **いい感じに待機**した後、非同期処理の結果そのものが取れる

<!--
最低限この知識でどうにかなります。
また、この知識が頭に入っていれば他の非同期処理の解説が格段に読みやすくなると思います。
是非非同期マスター目指してみてください。
-->

---

# 本日のおまけ

```JavaScript
const ieyasu = async hototogisu => {
  if (hototogisu.isSilent()) {
    await hototogisu.singAsync();
  }
};
```

![bg right 140%](./ieyasu.jpg)
